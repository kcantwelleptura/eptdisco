<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Value-Driven Discovery Tool</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      background: linear-gradient(to bottom right, #f8fafc, #e2e8f0);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
    }
    
    .header {
      text-align: center;
      margin-bottom: 50px;
    }
    
    .header h1 {
      font-size: 2.5rem;
      color: #1e293b;
      margin-bottom: 10px;
    }
    
    .header p {
      font-size: 1.1rem;
      color: #64748b;
    }
    
    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .product-card {
      padding: 40px;
      border-radius: 12px;
      color: white;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .product-card:hover {
      transform: scale(1.05);
      box-shadow: 0 10px 20px rgba(0,0,0,0.15);
    }
    
    .product-card h3 {
      font-size: 1.5rem;
      margin-bottom: 10px;
    }
    
    .product-card p {
      opacity: 0.9;
      font-size: 0.9rem;
    }
    
    .bg-blue { background: #3b82f6; }
    .bg-green { background: #22c55e; }
    .bg-purple { background: #a855f7; }
    .bg-orange { background: #f97316; }
    
    .question-container {
      background: white;
      border-radius: 12px;
      padding: 40px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .progress-bar {
      margin-bottom: 30px;
    }
    
    .progress-info {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      font-size: 0.9rem;
      color: #64748b;
    }
    
    .progress-track {
      width: 100%;
      height: 8px;
      background: #e2e8f0;
      border-radius: 4px;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      transition: width 0.3s;
      border-radius: 4px;
    }
    
    .category-badge {
      display: inline-block;
      padding: 8px 16px;
      background: #f1f5f9;
      color: #475569;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 500;
      margin-bottom: 20px;
    }
    
    .question-title {
      font-size: 1.5rem;
      color: #1e293b;
      margin-bottom: 15px;
      line-height: 1.4;
    }
    
    .follow-up {
      font-style: italic;
      color: #64748b;
      margin-bottom: 30px;
      line-height: 1.6;
    }
    
    .options {
      margin-bottom: 40px;
    }
    
    .option-button {
      width: 100%;
      padding: 20px;
      margin-bottom: 12px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      background: white;
      color: #475569;
      font-size: 1rem;
      cursor: pointer;
      text-align: left;
      transition: all 0.2s;
    }
    
    .option-button:hover {
      border-color: #cbd5e1;
      background: #f8fafc;
    }
    
    .option-button.selected {
      color: white;
      border-color: transparent;
    }
    
    .navigation {
      display: flex;
      justify-content: space-between;
    }
    
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .btn-secondary {
      background: white;
      color: #475569;
      border: 2px solid #cbd5e1;
    }
    
    .btn-secondary:hover:not(:disabled) {
      background: #f8fafc;
    }
    
    .btn-primary {
      color: white;
    }
    
    .btn-primary:hover:not(:disabled) {
      opacity: 0.9;
    }
    
    .results-container {
      background: white;
      border-radius: 12px;
      padding: 40px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .results-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 40px;
    }
    
    .results-title h1 {
      font-size: 2rem;
      color: #1e293b;
      margin-bottom: 5px;
    }
    
    .results-title p {
      color: #64748b;
    }
    
    .btn-reset {
      padding: 12px 24px;
      background: #475569;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    
    .btn-reset:hover {
      background: #334155;
    }
    
    .scores-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }
    
    .score-card {
      padding: 24px;
      border-radius: 8px;
      border: 2px solid;
    }
    
    .score-card.low {
      background: #f0fdf4;
      border-color: #86efac;
      color: #166534;
    }
    
    .score-card.medium {
      background: #fefce8;
      border-color: #fde047;
      color: #854d0e;
    }
    
    .score-card.high {
      background: #fef2f2;
      border-color: #fca5a5;
      color: #991b1b;
    }
    
    .score-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 15px;
    }
    
    .score-header h3 {
      font-size: 1.1rem;
      font-weight: 600;
    }
    
    .impact-badge {
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 0.85rem;
      font-weight: 500;
      background: rgba(255,255,255,0.5);
    }
    
    .score-value {
      margin-bottom: 15px;
      font-weight: 500;
    }
    
    .talking-point {
      font-size: 0.9rem;
      line-height: 1.6;
    }
    
    .answers-section {
      background: #f8fafc;
      padding: 30px;
      border-radius: 8px;
    }
    
    .answers-section h2 {
      font-size: 1.3rem;
      color: #1e293b;
      margin-bottom: 20px;
    }
    
    .answer-item {
      background: white;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 12px;
    }
    
    .answer-question {
      font-size: 0.9rem;
      color: #64748b;
      margin-bottom: 8px;
    }
    
    .answer-value {
      color: #1e293b;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .checkmark {
      color: #22c55e;
      font-weight: bold;
    }
    
    .hidden {
      display: none;
    }
    
    .question-list-item {
      background: #f8fafc;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .question-list-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 15px;
    }
    
    .question-list-number {
      background: #3b82f6;
      color: white;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 0.9rem;
    }
    
    .question-list-category {
      padding: 4px 12px;
      background: #f1f5f9;
      color: #475569;
      border-radius: 12px;
      font-size: 0.85rem;
      font-weight: 500;
    }
    
    .question-list-title {
      font-size: 1.1rem;
      color: #1e293b;
      margin-bottom: 10px;
      font-weight: 600;
    }
    
    .question-list-followup {
      font-size: 0.9rem;
      color: #64748b;
      font-style: italic;
      margin-bottom: 15px;
    }
    
    .question-list-options {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .list-option-button {
      padding: 12px 16px;
      border: 2px solid #e2e8f0;
      border-radius: 6px;
      background: white;
      color: #475569;
      font-size: 0.95rem;
      cursor: pointer;
      text-align: left;
      transition: all 0.2s;
    }
    
    .list-option-button:hover {
      border-color: #cbd5e1;
      background: #f8fafc;
    }
    
    .list-option-button.selected {
      border-color: transparent;
      color: white;
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="productSelection">
      <div class="header">
        <h1>Value-Driven Discovery</h1>
        <p>Select a product to begin guided discovery</p>
      </div>
      
      <div class="product-grid">
        <div class="product-card bg-blue" id="visitor-card">
          <h3>Visitor Management</h3>
          <p id="visitor-count"></p>
        </div>
        <div class="product-card bg-green" id="workplace-card">
          <h3>Workplace Management</h3>
          <p id="workplace-count"></p>
        </div>
        <div class="product-card bg-purple" id="asset-card">
          <h3>Asset Management</h3>
          <p id="asset-count"></p>
        </div>
        <div class="product-card bg-orange" id="engage-card">
          <h3>Employee Engagement</h3>
          <p id="engage-count"></p>
        </div>
      </div>
    </div>

    <div id="questionView" class="hidden">
      <div class="question-container">
        <div class="view-toggle" style="margin-bottom: 20px; text-align: center;">
          <button class="btn btn-secondary" id="toggleViewBtn" style="margin: 0 auto;">
            Switch to List View
          </button>
        </div>

        <div id="stepByStepView">
          <div class="progress-bar">
            <div class="progress-info">
              <span id="progressText"></span>
              <span id="productName"></span>
            </div>
            <div class="progress-track">
              <div id="progressFill" class="progress-fill"></div>
            </div>
          </div>

          <div class="category-badge" id="categoryBadge"></div>
          <h2 class="question-title" id="questionTitle"></h2>
          <p class="follow-up" id="followUp"></p>
          
          <div class="options" id="optionsContainer"></div>

          <div class="navigation">
            <button class="btn btn-secondary" id="prevBtn">
              ‚Üê Previous
            </button>
            <button class="btn btn-primary" id="nextBtn" disabled>
              Next ‚Üí
            </button>
          </div>
        </div>

        <div id="listView" class="hidden">
          <div style="margin-bottom: 20px;">
            <h2 style="color: #1e293b; margin-bottom: 10px;">All Questions</h2>
            <p style="color: #64748b;" id="listProductName"></p>
          </div>
          <div id="allQuestionsContainer"></div>
          <div style="margin-top: 30px; text-align: center;">
            <button class="btn btn-primary" id="submitAllBtn" style="margin: 0 auto;">
              View Results ‚Üí
            </button>
          </div>
        </div>
      </div>
    </div>

    <div id="resultsView" class="hidden">
      <div class="results-container">
        <div class="results-header">
          <div class="results-title">
            <h1>Discovery Results</h1>
            <p id="resultsProduct"></p>
          </div>
          <div style="display: flex; gap: 10px;">
            <button class="btn-reset" id="downloadPdfBtn" style="background: #3b82f6;">Download PDF</button>
            <button class="btn-reset" id="resetBtn">Start Over</button>
          </div>
        </div>

        <div class="scores-grid" id="scoresGrid"></div>

        <div class="answers-section">
          <h2>üìã Your Answers</h2>
          <div id="answersContainer"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    var state = {
      currentProduct: null,
      currentStep: 0,
      answers: {},
      filteredQuestions: [],
      viewMode: 'step'
    };

    var products = {
      visitor: { name: 'Visitor Management', color: '#3b82f6' },
      workplace: { name: 'Workplace Management', color: '#22c55e' },
      asset: { name: 'Asset Management', color: '#a855f7' },
      engage: { name: 'Employee Engagement', color: '#f97316' }
    };

    var questions = [
      {
        id: 'nda_collection',
        product: 'visitor',
        category: 'Security & Compliance',
        question: 'How consistently are NDA forms being collected and signed before check-in?',
        followUp: 'How does inconsistent NDA collection impact legal exposure or partner trust?',
        options: ['under 10%', 'under 50%', 'over 50%'],
        scoreMap: { 'under 10%': 1, 'under 50%': 2, 'over 50%': 3 }
      },
      {
        id: 'nda_compliance',
        product: 'visitor',
        category: 'Security & Compliance',
        question: 'What is our NDA compliance rate across teams or locations?',
        followUp: 'What is the business risk of low NDA compliance across teams or locations?',
        options: ['under 10%', 'under 50%', 'over 50%'],
        scoreMap: { 'under 10%': 1, 'under 50%': 2, 'over 50%': 3 }
      },
      {
        id: 'guest_reporting',
        product: 'visitor',
        category: 'Security & Compliance',
        question: 'How long does it take to generate guest reports, and what delays are common?',
        followUp: 'How do delays in guest reporting affect audit readiness or incident response?',
        options: ['under 10%', 'under 50%', 'over 50%'],
        scoreMap: { 'under 10%': 1, 'under 50%': 2, 'over 50%': 3 }
      },
      {
        id: 'evacuation_lists',
        product: 'visitor',
        category: 'Security & Compliance',
        question: 'Are evacuation lists current and inclusive of all relevant personnel?',
        followUp: 'What is the operational risk if evacuation lists are outdated or incomplete?',
        options: ['yes', 'sometimes', 'no'],
        scoreMap: { 'yes': 1, 'sometimes': 2, 'no': 3 }
      },
      {
        id: 'audit_success',
        product: 'visitor',
        category: 'Security & Compliance',
        question: 'How successful are we in passing compliance audits, and what risks are we mitigating?',
        followUp: 'What is the business impact of audit performance in terms of financial exposure, operational disruption, or reputational risk?',
        options: ['under 10%', 'under 50%', 'over 50%'],
        scoreMap: { 'under 10%': 1, 'under 50%': 2, 'over 50%': 3 }
      },
      {
        id: 'meeting_alignment',
        product: 'visitor',
        category: 'Employee Experience',
        question: 'How often do booking conflicts occur, and what is driving them?',
        followUp: 'How does misaligned meeting attendance affect productivity or decision-making?',
        options: ['Never', 'half', 'often'],
        scoreMap: { 'Never': 1, 'half': 2, 'often': 3 }
      },
      {
        id: 'booking_conflicts',
        product: 'visitor',
        category: 'Decision Making Clarity',
        question: 'How accurate is our occupancy data compared to actual usage?',
        options: ['under 10%', 'under 50%', 'over 50%'],
        scoreMap: { 'under 10%': 1, 'under 50%': 2, 'over 50%': 3 }
      },
      {
        id: 'brand_impression',
        product: 'visitor',
        category: 'Employee Experience',
        question: 'How closely aligned is your current visitor experience to your Brand representation?',
        followUp: 'How well does your current visitor experience reflect your brand values and expectations?',
        options: ['spot on', 'close', 'terrible'],
        scoreMap: { 'spot on': 1, 'close': 2, 'terrible': 3 }
      },
      {
        id: 'unauthorized_access',
        product: 'visitor',
        category: 'Security & Compliance',
        question: 'How many unauthorized access incidents or security breaches have you experienced in the past year?',
        followUp: 'What is the potential impact of unauthorized visitor access on your operations and security?',
        options: ['none or 1-2', '3-5 incidents', 'more than 5'],
        scoreMap: { 'none or 1-2': 1, '3-5 incidents': 2, 'more than 5': 3 }
      },
      {
        id: 'pre_registration_rate',
        product: 'visitor',
        category: 'Operational Efficiency',
        question: 'What percentage of your visitors pre-register before arrival?',
        followUp: 'How does low pre-registration impact wait times and receptionist workload?',
        options: ['over 60%', '30-60%', 'under 30%'],
        scoreMap: { 'over 60%': 1, '30-60%': 2, 'under 30%': 3 }
      },
      {
        id: 'check_in_time',
        product: 'visitor',
        category: 'Employee Experience',
        question: 'What percentage of visitors complete check-in in under 2 minutes?',
        followUp: 'How do long wait times affect visitor satisfaction and your brand impression?',
        options: ['over 80%', '50-80%', 'under 50%'],
        scoreMap: { 'over 80%': 1, '50-80%': 2, 'under 50%': 3 }
      },
      {
        id: 'self_service_adoption',
        product: 'visitor',
        category: 'Operational Efficiency',
        question: 'What percentage of visitors use self-service check-in like kiosks or QR codes?',
        followUp: 'How much receptionist time could be saved with higher self-service adoption?',
        options: ['over 50%', '25-50%', 'under 25%'],
        scoreMap: { 'over 50%': 1, '25-50%': 2, 'under 25%': 3 }
      },
      {
        id: 'visitor_nps',
        product: 'visitor',
        category: 'Employee Experience',
        question: 'What is your visitor satisfaction score or NPS?',
        followUp: 'How does visitor experience quality impact your reputation with clients and partners?',
        options: ['high or positive', 'neutral', 'low or negative'],
        scoreMap: { 'high or positive': 1, 'neutral': 2, 'low or negative': 3 }
      },
      {
        id: 'watchlist_screening',
        product: 'visitor',
        category: 'Security & Compliance',
        question: 'Do you currently screen visitors against watchlists or blocked lists?',
        followUp: 'What is the risk of not identifying blocked or high-risk visitors before entry?',
        options: ['yes always', 'sometimes', 'no'],
        scoreMap: { 'yes always': 1, 'sometimes': 2, 'no': 3 }
      },
      {
        id: 'manual_receptionist_work',
        product: 'visitor',
        category: 'Operational Efficiency',
        question: 'How much time does your reception staff spend on manual visitor check-in per day?',
        followUp: 'What productivity gains could you achieve by reducing manual entry and paperwork?',
        options: ['under 2 hours', '2-4 hours', 'over 4 hours'],
        scoreMap: { 'under 2 hours': 1, '2-4 hours': 2, 'over 4 hours': 3 }
      },
      {
        id: 'host_notifications',
        product: 'visitor',
        category: 'Employee Experience',
        question: 'Do hosts receive real-time notifications when their visitors arrive?',
        followUp: 'How does delayed host awareness impact visitor experience and meeting efficiency?',
        options: ['yes automatic', 'sometimes manual', 'no'],
        scoreMap: { 'yes automatic': 1, 'sometimes manual': 2, 'no': 3 }
      },
      {
        id: 'calendar_integration',
        product: 'visitor',
        category: 'Operational Efficiency',
        question: 'What percentage of visitor appointments are linked to calendar invites or meetings?',
        followUp: 'How could calendar integration streamline visitor management in a hybrid work environment?',
        options: ['over 60%', '30-60%', 'under 30%'],
        scoreMap: { 'over 60%': 1, '30-60%': 2, 'under 30%': 3 }
      },
      {
        id: 'multilingual_support',
        product: 'visitor',
        category: 'Employee Experience',
        question: 'Do you offer check-in instructions in multiple languages for international visitors?',
        followUp: 'How does language barriers impact visitor experience and check-in efficiency?',
        options: ['yes multiple languages', 'limited', 'english only'],
        scoreMap: { 'yes multiple languages': 1, 'limited': 2, 'english only': 3 }
      },
      {
        id: 'audit_trail',
        product: 'visitor',
        category: 'Security & Compliance',
        question: 'How quickly can you generate audit reports for visitor activity and compliance?',
        followUp: 'What is the cost of poor audit trails during compliance reviews or investigations?',
        options: ['instantly automated', 'hours or days', 'manual and slow'],
        scoreMap: { 'instantly automated': 1, 'hours or days': 2, 'manual and slow': 3 }
      },
      {
        id: 'access_control_integration',
        product: 'visitor',
        category: 'Security & Compliance',
        question: 'Is your visitor management system integrated with access control systems?',
        followUp: 'How does lack of integration create security gaps and manual overhead?',
        options: ['yes fully integrated', 'partially', 'no integration'],
        scoreMap: { 'yes fully integrated': 1, 'partially': 2, 'no integration': 3 }
      },
      {
        id: 'collaboration_frequency',
        product: 'workplace',
        category: 'Decision-Making Clarity',
        question: 'How frequently do teams collaborate in person each month?',
        followUp: 'Where are we losing availability due to booking misuse and how can we reclaim space for active use?',
        options: ['multiple times per week', 'weekly', 'bi-weekly or less'],
        scoreMap: { 'multiple times per week': 1, 'weekly': 2, 'bi-weekly or less': 3 }
      },
      {
        id: 'no_show_rate',
        product: 'workplace',
        category: 'Employee Experience',
        question: 'What is our no-show rate, and how does it impact space planning?',
        followUp: 'What is the cost of booking conflicts in terms of lost time or employee frustration?',
        options: ['under 10%', 'under 50%', 'over 50%'],
        scoreMap: { 'under 10%': 1, 'under 50%': 2, 'over 50%': 3 }
      },
      {
        id: 'sensor_usage',
        product: 'engage',
        category: 'Decision-Making Clarity',
        question: 'Are you using sensors to better understand occupancy?',
        followUp: 'What patterns are emerging in badge noncompliance, and what risks do they pose?',
        options: ['yes', 'sometimes', 'no'],
        scoreMap: { 'yes': 1, 'sometimes': 2, 'no': 3 }
      },
      {
        id: 'booking_success',
        product: 'engage',
        category: 'Employee Experience',
        question: 'What percentage of room and desk bookings are successful?',
        options: ['under 10%', 'under 50%', 'over 50%'],
        scoreMap: { 'under 10%': 1, 'under 50%': 2, 'over 50%': 3 }
      },
      {
        id: 'employee_satisfaction',
        product: 'engage',
        category: 'Employee Experience',
        question: 'How satisfied are employees with their workplace experience?',
        followUp: 'How does our workplace experience influence retention, engagement, and overall performance?',
        options: ['satisfied', 'unsatisfied', 'very unsatisfied'],
        scoreMap: { 'satisfied': 1, 'unsatisfied': 2, 'very unsatisfied': 3 }
      },
      {
        id: 'booking_time',
        product: 'engage',
        category: 'Employee Experience',
        question: 'How long does it take on average to book a space?',
        followUp: 'How frictionless is our space booking process and what is the cost of inefficiency?',
        options: ['under 5 minutes', 'under 10 minutes', 'over 10 minutes'],
        scoreMap: { 'under 5 minutes': 1, 'under 10 minutes': 2, 'over 10 minutes': 3 }
      },
      {
        id: 'repeat_usage',
        product: 'engage',
        category: 'Employee Experience',
        question: 'What percentage of users return to book again, and what drives repeat usage?',
        followUp: 'What drives repeat bookings and how does that reflect on space value or experience?',
        options: ['under 10%', 'under 50%', 'over 50%'],
        scoreMap: { 'under 10%': 1, 'under 50%': 2, 'over 50%': 3 }
      }
    ];

    var talkingPoints = {
      'Operational Efficiency': {
        Low: 'Processes are stable, but there is room to streamline reporting and reduce manual effort.',
        Medium: 'Efficiency gaps are visible‚Äîautomation and consolidation could free up significant time.',
        High: 'High inefficiency signals urgent opportunity‚Äîothers in your position reduced IT overhead by 15‚Äì20%.'
      },
      'Employee Experience': {
        Low: 'Employees are generally satisfied, but booking friction may still cause frustration.',
        Medium: 'Experience is mixed‚Äîstreamlining booking and reducing no-shows could lift satisfaction scores.',
        High: 'High impact on experience‚Äîteams with similar challenges saw 20‚Äì25% EX/NPS improvement.'
      },
      'Security & Compliance': {
        Low: 'Compliance is strong, but monitoring accuracy can be tightened further.',
        Medium: 'Medium risk‚Äîbadge accuracy, visitor access, and tailgating incidents suggest gaps in workplace security.',
        High: 'High impact‚Äîsecurity lapses expose risk; stronger compliance and visitor controls reduce liability and improve safety.'
      },
      'Decision-Making Clarity': {
        Low: 'Data confidence is solid, but leaders may still want deeper visibility.',
        Medium: 'Medium confidence‚Äîdecisions may be riskier than they need to be.',
        High: 'High impact‚Äîleaders lack clarity; accurate data enables confident portfolio decisions.'
      },
      'Decision Making Clarity': {
        Low: 'Data confidence is solid, but leaders may still want deeper visibility.',
        Medium: 'Medium confidence‚Äîdecisions may be riskier than they need to be.',
        High: 'High impact‚Äîleaders lack clarity; accurate data enables confident portfolio decisions.'
      },
      'Space Utilization': {
        Low: 'Utilization is steady, but there may be hidden inefficiencies in portfolio costs.',
        Medium: 'Medium utilization suggests opportunity to reclaim space and reduce wasted spend.',
        High: 'High impact‚Äîorganizations often see 10‚Äì15% real estate savings with improved utilization.'
      }
    };

    function initCounts() {
      var productTypes = ['visitor', 'workplace', 'asset', 'engage'];
      for (var i = 0; i < productTypes.length; i++) {
        var product = productTypes[i];
        var count = 0;
        for (var j = 0; j < questions.length; j++) {
          if (questions[j].product === product) {
            count++;
          }
        }
        document.getElementById(product + '-count').textContent = count + ' discovery questions';
      }
    }

    function selectProduct(product) {
      state.currentProduct = product;
      state.filteredQuestions = [];
      for (var i = 0; i < questions.length; i++) {
        if (questions[i].product === product) {
          state.filteredQuestions.push(questions[i]);
        }
      }
      state.currentStep = 0;
      state.answers = {};
      state.viewMode = 'step'; // Default to step-by-step view
      
      document.getElementById('productSelection').classList.add('hidden');
      document.getElementById('questionView').classList.remove('hidden');
      
      renderQuestion();
    }
    
    function toggleView() {
      if (state.viewMode === 'step') {
        state.viewMode = 'list';
        document.getElementById('stepByStepView').classList.add('hidden');
        document.getElementById('listView').classList.remove('hidden');
        document.getElementById('toggleViewBtn').textContent = 'Switch to Step-by-Step';
        renderListView();
      } else {
        state.viewMode = 'step';
        document.getElementById('listView').classList.add('hidden');
        document.getElementById('stepByStepView').classList.remove('hidden');
        document.getElementById('toggleViewBtn').textContent = 'Switch to List View';
        renderQuestion();
      }
    }
    
    function renderListView() {
      document.getElementById('listProductName').textContent = products[state.currentProduct].name;
      
      var container = document.getElementById('allQuestionsContainer');
      container.innerHTML = '';
      
      for (var i = 0; i < state.filteredQuestions.length; i++) {
        var q = state.filteredQuestions[i];
        
        var item = document.createElement('div');
        item.className = 'question-list-item';
        
        var header = document.createElement('div');
        header.className = 'question-list-header';
        
        var number = document.createElement('div');
        number.className = 'question-list-number';
        number.textContent = (i + 1);
        number.style.background = products[state.currentProduct].color;
        
        var category = document.createElement('div');
        category.className = 'question-list-category';
        category.textContent = q.category;
        
        header.appendChild(number);
        header.appendChild(category);
        
        var title = document.createElement('div');
        title.className = 'question-list-title';
        title.textContent = q.question;
        
        item.appendChild(header);
        item.appendChild(title);
        
        if (q.followUp) {
          var followUp = document.createElement('div');
          followUp.className = 'question-list-followup';
          followUp.textContent = 'Follow-up: ' + q.followUp;
          item.appendChild(followUp);
        }
        
        var optionsContainer = document.createElement('div');
        optionsContainer.className = 'question-list-options';
        
        for (var j = 0; j < q.options.length; j++) {
          var option = q.options[j];
          var optionBtn = document.createElement('button');
          optionBtn.className = 'list-option-button';
          optionBtn.textContent = option;
          optionBtn.setAttribute('data-question-id', q.id);
          optionBtn.setAttribute('data-option', option);
          
          if (state.answers[q.id] === option) {
            optionBtn.classList.add('selected');
            optionBtn.style.background = products[state.currentProduct].color;
          }
          
          optionBtn.addEventListener('click', function() {
            var qId = this.getAttribute('data-question-id');
            var opt = this.getAttribute('data-option');
            selectAnswerList(qId, opt);
          });
          
          optionsContainer.appendChild(optionBtn);
        }
        
        item.appendChild(optionsContainer);
        container.appendChild(item);
      }
      
      updateSubmitButton();
    }
    
    function selectAnswerList(questionId, answer) {
      state.answers[questionId] = answer;
      renderListView();
    }
    
    function updateSubmitButton() {
      var allAnswered = true;
      for (var i = 0; i < state.filteredQuestions.length; i++) {
        if (!state.answers[state.filteredQuestions[i].id]) {
          allAnswered = false;
          break;
        }
      }
      
      var submitBtn = document.getElementById('submitAllBtn');
      submitBtn.disabled = !allAnswered;
      submitBtn.style.background = allAnswered ? products[state.currentProduct].color : '#cbd5e1';
    }

    function renderQuestion() {
      var question = state.filteredQuestions[state.currentStep];
      var progress = ((state.currentStep + 1) / state.filteredQuestions.length) * 100;
      
      document.getElementById('progressText').textContent = 'Question ' + (state.currentStep + 1) + ' of ' + state.filteredQuestions.length;
      document.getElementById('productName').textContent = products[state.currentProduct].name;
      document.getElementById('progressFill').style.width = progress + '%';
      document.getElementById('progressFill').style.background = products[state.currentProduct].color;
      
      document.getElementById('categoryBadge').textContent = question.category;
      document.getElementById('questionTitle').textContent = question.question;
      
      var followUpEl = document.getElementById('followUp');
      if (question.followUp) {
        followUpEl.textContent = 'Follow-up: ' + question.followUp;
        followUpEl.style.display = 'block';
      } else {
        followUpEl.style.display = 'none';
      }
      
      var optionsContainer = document.getElementById('optionsContainer');
      optionsContainer.innerHTML = '';
      
      for (var i = 0; i < question.options.length; i++) {
        var option = question.options[i];
        var button = document.createElement('button');
        button.className = 'option-button';
        button.textContent = option;
        button.setAttribute('data-option', option);
        button.addEventListener('click', function() {
          selectAnswer(question.id, this.getAttribute('data-option'));
        });
        
        if (state.answers[question.id] === option) {
          button.classList.add('selected');
          button.style.background = products[state.currentProduct].color;
        }
        
        optionsContainer.appendChild(button);
      }
      
      updateNavigation();
    }

    function selectAnswer(questionId, answer) {
      state.answers[questionId] = answer;
      renderQuestion();
    }

    function updateNavigation() {
      var question = state.filteredQuestions[state.currentStep];
      var hasAnswer = !!state.answers[question.id];
      
      document.getElementById('prevBtn').disabled = state.currentStep === 0;
      document.getElementById('nextBtn').disabled = !hasAnswer;
      document.getElementById('nextBtn').style.background = products[state.currentProduct].color;
      
      var isLastQuestion = state.currentStep === state.filteredQuestions.length - 1;
      document.getElementById('nextBtn').innerHTML = isLastQuestion ? 'View Results ‚Üí' : 'Next ‚Üí';
    }

    function previousQuestion() {
      if (state.currentStep > 0) {
        state.currentStep--;
        renderQuestion();
      }
    }

    function nextQuestion() {
      if (state.currentStep < state.filteredQuestions.length - 1) {
        state.currentStep++;
        renderQuestion();
      } else {
        showResults();
      }
    }

    function calculateScores() {
      var scores = {};
      
      for (var i = 0; i < state.filteredQuestions.length; i++) {
        var q = state.filteredQuestions[i];
        var answer = state.answers[q.id];
        if (answer) {
          if (!scores[q.category]) {
            scores[q.category] = { total: 0, count: 0 };
          }
          scores[q.category].total += q.scoreMap[answer];
          scores[q.category].count += 1;
        }
      }
      
      var averages = {};
      for (var category in scores) {
        var avg = scores[category].total / scores[category].count;
        averages[category] = {
          score: avg,
          level: avg <= 1.5 ? 'Low' : avg <= 2.2 ? 'Medium' : 'High'
        };
      }
      
      return averages;
    }
    
    function generatePDF() {
      var jsPDF = window.jspdf.jsPDF;
      var doc = new jsPDF();
      
      var pageWidth = doc.internal.pageSize.getWidth();
      var pageHeight = doc.internal.pageSize.getHeight();
      var margin = 20;
      var yPos = margin;
      var lineHeight = 7;
      
      // Title
      doc.setFontSize(20);
      doc.setFont(undefined, 'bold');
      doc.text('Value-Driven Discovery Report', margin, yPos);
      yPos += 10;
      
      // Product name
      doc.setFontSize(12);
      doc.setFont(undefined, 'normal');
      doc.setTextColor(100);
      doc.text(products[state.currentProduct].name, margin, yPos);
      yPos += 10;
      
      // Date
      var today = new Date();
      doc.setFontSize(10);
      doc.text('Generated: ' + today.toLocaleDateString(), margin, yPos);
      yPos += 15;
      
      // Category Scores Section
      doc.setFontSize(16);
      doc.setFont(undefined, 'bold');
      doc.setTextColor(0);
      doc.text('Impact Assessment', margin, yPos);
      yPos += 10;
      
      var categoryScores = calculateScores();
      doc.setFontSize(10);
      doc.setFont(undefined, 'normal');
      
      for (var category in categoryScores) {
        var data = categoryScores[category];
        
        // Check if we need a new page
        if (yPos > pageHeight - 40) {
          doc.addPage();
          yPos = margin;
        }
        
        // Category name
        doc.setFont(undefined, 'bold');
        doc.text(category, margin, yPos);
        yPos += lineHeight;
        
        // Score and level
        doc.setFont(undefined, 'normal');
        doc.text('Score: ' + data.score.toFixed(2) + ' - ' + data.level + ' Impact', margin + 5, yPos);
        yPos += lineHeight;
        
        // Talking point
        var talkingPoint = 'No talking point available';
        if (talkingPoints[category] && talkingPoints[category][data.level]) {
          talkingPoint = talkingPoints[category][data.level];
        }
        
        doc.setFontSize(9);
        doc.setTextColor(80);
        var splitText = doc.splitTextToSize(talkingPoint, pageWidth - (margin * 2));
        doc.text(splitText, margin + 5, yPos);
        yPos += splitText.length * lineHeight + 5;
        
        doc.setFontSize(10);
        doc.setTextColor(0);
      }
      
      // Add new page for questions and answers
      doc.addPage();
      yPos = margin;
      
      doc.setFontSize(16);
      doc.setFont(undefined, 'bold');
      doc.text('Discovery Questions & Answers', margin, yPos);
      yPos += 15;
      
      doc.setFontSize(10);
      
      for (var i = 0; i < state.filteredQuestions.length; i++) {
        var q = state.filteredQuestions[i];
        var answer = state.answers[q.id];
        
        if (answer) {
          // Check if we need a new page
          if (yPos > pageHeight - 50) {
            doc.addPage();
            yPos = margin;
          }
          
          // Question number and category
          doc.setFont(undefined, 'bold');
          doc.setTextColor(0);
          doc.text('Q' + (i + 1) + ': ' + q.category, margin, yPos);
          yPos += lineHeight;
          
          // Question text
          doc.setFont(undefined, 'normal');
          doc.setFontSize(9);
          var questionText = doc.splitTextToSize(q.question, pageWidth - (margin * 2));
          doc.text(questionText, margin, yPos);
          yPos += questionText.length * lineHeight;
          
          // Answer
          doc.setFont(undefined, 'bold');
          doc.setTextColor(60, 130, 246); // Blue color for answer
          doc.text('Answer: ' + answer, margin, yPos);
          yPos += lineHeight + 5;
          
          doc.setTextColor(0);
          doc.setFontSize(10);
        }
      }
      
      // Save the PDF
      var filename = 'Discovery-Report-' + products[state.currentProduct].name.replace(/\s+/g, '-') + '-' + today.toISOString().split('T')[0] + '.pdf';
      doc.save(filename);
    }

    function showResults() {
      document.getElementById('questionView').classList.add('hidden');
      document.getElementById('resultsView').classList.remove('hidden');
      
      document.getElementById('resultsProduct').textContent = products[state.currentProduct].name;
      
      var resetBtn = document.getElementById('resetBtn');
      resetBtn.onclick = resetTool;
      
      var pdfBtn = document.getElementById('downloadPdfBtn');
      pdfBtn.onclick = generatePDF;
      
      var categoryScores = calculateScores();
      var scoresGrid = document.getElementById('scoresGrid');
      scoresGrid.innerHTML = '';
      
      for (var category in categoryScores) {
        var data = categoryScores[category];
        var card = document.createElement('div');
        card.className = 'score-card ' + data.level.toLowerCase();
        
        var talkingPoint = 'No talking point available';
        if (talkingPoints[category] && talkingPoints[category][data.level]) {
          talkingPoint = talkingPoints[category][data.level];
        }
        
        card.innerHTML = '<div class="score-header"><h3>' + category + '</h3><span class="impact-badge">' + data.level + ' Impact</span></div><div class="score-value">üìä Score: ' + data.score.toFixed(2) + '</div><div class="talking-point">' + talkingPoint + '</div>';
        
        scoresGrid.appendChild(card);
      }
      
      var answersContainer = document.getElementById('answersContainer');
      answersContainer.innerHTML = '';
      
      for (var i = 0; i < state.filteredQuestions.length; i++) {
        var q = state.filteredQuestions[i];
        var answer = state.answers[q.id];
        if (answer) {
          var item = document.createElement('div');
          item.className = 'answer-item';
          item.innerHTML = '<div class="answer-question">' + q.question + '</div><div class="answer-value"><span class="checkmark">‚úì</span>' + answer + '</div>';
          answersContainer.appendChild(item);
        }
      }
    }

    function resetTool() {
      state.currentProduct = null;
      state.currentStep = 0;
      state.answers = {};
      state.filteredQuestions = [];
      
      document.getElementById('resultsView').classList.add('hidden');
      document.getElementById('productSelection').classList.remove('hidden');
    }

    document.addEventListener('DOMContentLoaded', function() {
      initCounts();
      
      document.getElementById('visitor-card').addEventListener('click', function() { selectProduct('visitor'); });
      document.getElementById('workplace-card').addEventListener('click', function() { selectProduct('workplace'); });
      document.getElementById('asset-card').addEventListener('click', function() { selectProduct('asset'); });
      document.getElementById('engage-card').addEventListener('click', function() { selectProduct('engage'); });
      
      document.getElementById('prevBtn').addEventListener('click', previousQuestion);
      document.getElementById('nextBtn').addEventListener('click', nextQuestion);
      document.getElementById('toggleViewBtn').addEventListener('click', toggleView);
      document.getElementById('submitAllBtn').addEventListener('click', showResults);
    });
  </script>
</body>
</html>
